# Bookstack Module
This module installs bookstack and all it's components.

## Simple Setup
Setting the following...
```
megacorp.services.bookstack = {
  enable = true;
  app-key-file = "/run/secrets/bookstack-keyfile";
}
```
Will:
- Install Bookstack
- install MySQL (MariaDB)
- Install Nginx
- Open port TCP/80
- Configure Bookstack to connect to the MySQL instance
- Configure Nginx to serve Bookstack over http://localhost 

A secrets management solution should be implemented to securely pass the required Bookstack app key file. This can be generated by `head -c 32 /dev/urandom | base64`. Setting up a secrets management solution is out of scope for this document.

Since `megacorp.services.bookstack.fqdn` still has the default value "localhost" Nginx will improperly handle any requests (for example requests made to the bookstack servers IP). It will however be available via http://localhost on the bookstack server itself.

To make it accessible over the network over it's IP for example...
```
megacorp.services.bookstack = {
  enable = true;
  app-key-file = "/run/secrets/bookstack-keyfile";
  fqdn = "192.168.1.10";
}
```
Or via a domain name...
```
megacorp.services.bookstack = {
  enable = true;
  app-key-file = "/run/secrets/bookstack-keyfile";
  fqdn = "bookstack.local";
}
```

## TLS
To enable TLS over HTTP...
```
megacorp.services.bookstack = {
  enable = true;
  app-key-file = "/run/secrets/bookstack-keyfile";
  fqdn = "bookstack.local";
  tls = {
    enable = true;
  };
}
```
This will redirect all HTTP requests to HTTPS and attempt to generated signed certificates from Let's Encrypt servers. For this ports 80/443 on the bookstack server must be accessible to the internet either via port forwarding or directly exposed to the internet. If these conditions aren't met self-signed certificates will be created instead.

A custom TLS certificate can be used by specifying the cert + key file like so...
```
megacorp.services.bookstack = {
  enable = true;
  app-key-file = "/run/secrets/bookstack-keyfile";
  fqdn = "bookstack.local";
  tls = {
    enable = true;
    cert-file = "/var/lib/nginx/bookstack.crt";
    cert-key = "/var/lib/nginx/bookstack.key";
  };
}
```
And ensure the **/var/lib/nginx** directory has permissions like so...
```
chown nginx:nginx /var/lib/nginx
chown nginx:nginx /var/lib/nginx/*
chmod 755 /var/lib/nginx
chmod 600 /var/lib/nginx/*
```
